#!@ENV@ bash

# @PACKAGE@-@VERSION@ (@DESCRIPTION@) #

# Copyright (c) 2014 Antonio Cao (@burzumishi) #

# This is free software; 
# You have unlimited permission to copy and/or distribute it,
# with or without modifications, as long as this notice is preserved.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
# PARTICULAR PURPOSE.


# @PACKAGE@ @VERSION@ (@DESCRIPTION@) #
# Usage: xenesis <plugin_name> <host>||<host_list> <plugin_params (optional)>

# Operating System # Linux, HP-UX, CYGWIN_NT, ... #
OS=$(uname -s);

# Load Configuration Files #

# Import @PACKAGE@ Main Config File #
. @sysconfdir@/@PACKAGE@/@PACKAGE@.conf;

# Import @PACKAGE@ Dinamic Config Files (conf.d) #
if [ -d "@sysconfdir@/@PACKAGE@/conf.d" ]; then
        CONFD=$(find @sysconfdir@/@PACKAGE@/conf.d -iname "*.conf");
        for confd in $CONFD; do
                . $confd;
        done
fi;

# Import @PACKAGE@ OS Config Files (os) #
case $OS in
	# Operating System # Linux, HP-UX, CYGWIN_NT, ... #
	*linux*|*Linux*|*LINUX*) . @sysconfdir@/@PACKAGE@/os/linux.conf;
		;;
	*hp-ux*|*HP-UX*) . @sysconfdir@/@PACKAGE@/os/hpux.conf; # TODO TODO TODO #
		;;
	*FreeBSD*|*freebsd*) . @sysconfdir@/@PACKAGE@/os/freebsd.conf;
		;;
	*cygwin*|*CYGWIN*) . @sysconfdir@/@PACKAGE@/os/cygwin.conf; # TODO TODO TODO #
		;;
	*) . @sysconfdir@/@PACKAGE@/os/default.conf;
		;;
esac


# Load Libraries #

# Import @PACKAGE@ Core Functions #
. @libdir@/libxenesis.so;

# Import @PACKAGE@ Basic Host & Network Functions #
. @libdir@/libxenesis-net.so;

# Import @PACKAGE@ Remote Admin Layer (RAL) Functions #
. @libdir@/libxenesis-ral.so;

# Import @PACKAGE@ SSH Functions #
. @libdir@/libxenesis-ssh.so;


# Start @PACKAGE@ # libxenesis.so #

# Import @PACKAGE@ OS Specific Configurations #
setup_os_commands;

# Check @PACKAGE@ runtime directory structure # 
check_directory_structure "$LOGDIR" "$PLUGINSDIR" "$HOSTSDIR" "$SSHHOSTSDIR";

# Initialize @PACKAGE@ $LOG
$TOUCH $LOG;

# @PACKAGE@ display startmsg #
startmsg;

# @PACKAGE@ check current user #
check_user;


# @PACKAGE@ Read User Input [OPTIONS] #
case $1 in
# libxenesis-ral.so -- actions -- #
# start_ral: "$2 == $PLUGINS", "$3 == $HOST_LIST", "$4 == $PLUGIN_PARAMS" #
'load') start_ral "$2" "$3" "$4"; 
	;;
# start_ral_test: "$2 == $PLUGINS", "$3 == $HOST_LIST", "$4 == $PLUGIN_PARAMS" #
'test') start_ral_test "$2" "$3" "$4";
	;;
# libxenesis-ssh.so -- actions -- #
# exec_ssh_cmd: "$2 == $CMD", "$3 == $HOST_LIST" #
'exec') exec_ssh_cmd "$2" "$3"; 
	;;
# configure_ssh: "$2 == $HOST_LIST" #
'sshconf') configure_ssh "$2";
	;;
# usage: help #
*) usage; # @PACKAGE@ HELP #
	;;
esac

exit;
